<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>BNPL App</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:#f3f4f6}
.container{max-width:1200px;margin:0 auto;padding:20px}.header{background:white;padding:15px;margin-bottom:20px;border-radius:8px;display:flex;justify-content:space-between}
.btn{padding:10px 20px;margin:5px;cursor:pointer;border:none;border-radius:4px;background:#4f46e5;color:white;font-weight:bold}
.btn:hover{background:#4338ca}.btn-secondary{background:#6b7280}.btn-secondary:hover{background:#4b5563}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}
.card{background:white;padding:20px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border:1px solid #e5e7eb}
.tab-nav{display:flex;gap:10px;margin-bottom:20px;border-bottom:1px solid #e5e7eb;padding-bottom:10px}
.tab-nav button{background:none;border:none;padding:10px;cursor:pointer;border-bottom:3px solid transparent;color:#666}
.tab-nav button.active{border-bottom-color:#4f46e5;color:#4f46e5}
.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:bold;color:#333}
.form-group input,.form-group select{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}
input:focus,select:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px rgba(79,70,229,0.1)}
.text-center{text-align:center}.mt-20{margin-top:20px}.text-lg{font-size:18px;font-weight:bold}
.badge{display:inline-block;padding:5px 10px;border-radius:4px;font-size:12px;font-weight:bold}
.badge-success{background:#d4edda;color:#155724}.badge-danger{background:#f8d7da;color:#721c24}.badge-warning{background:#fff3cd;color:#856404}
table{width:100%;border-collapse:collapse;margin-top:15px}th,td{padding:10px;text-align:left;border-bottom:1px solid #ddd}
th{background:#f8f9fa;font-weight:bold}
</style>
</head>
<body>
<div id="app"></div>
<script>
let appState={user:null,selectedRole:null,currentView:'initiate',adminView:'dashboard',transaction:{policyNumber:'',amount:'',description:''},transactionStatus:null,loading:false,employers:[{id:'1',name:'ABC Company Ltd',employees:1247,limit:500000,monthlyDeduction:0.3},{id:'2',name:'XYZ Industries',employees:845,limit:400000,monthlyDeduction:0.25}],employees:{'1':[{id:'EMP-001',name:'John Kamau',salary:1500000,limit:450000,policyNumber:'202600123456',status:'active'},{id:'EMP-045',name:'Sarah Okello',salary:1200000,limit:360000,policyNumber:'202600234567',status:'active'},{id:'EMP-078',name:'Peter Musoke',salary:2000000,limit:600000,policyNumber:'202600345678',status:'active'}],'2':[{id:'EMP-201',name:'Jane Doe',salary:1800000,limit:450000,policyNumber:'202600456789',status:'active'}]},selectedEmployerId:null,showAddEmployerModal:false,newEmployer:{name:'',employees:'',limit:'',monthlyDeduction:''},transactions:[{id:'TX-001',policyNumber:'202600123456',amount:120000,status:'approved',date:'2026-01-20',customer:'John Kamau',affordability:450000,merchant:'Jumia'},{id:'TX-002',policyNumber:'202600234567',amount:85000,status:'approved',date:'2026-01-19',customer:'Sarah Okello',affordability:360000,merchant:'Glovo'},{id:'TX-003',policyNumber:'202600345678',amount:200000,status:'pending',date:'2026-01-18',customer:'Peter Musoke',affordability:600000,merchant:'Amazon'}]};

function render(){const app=document.getElementById('app');if(!appState.user){app.innerHTML=renderLogin()}else if(appState.user.role==='merchant'){app.innerHTML=renderMerchant()}else if(appState.user.role==='employer'){app.innerHTML=renderEmployer()}else if(appState.user.role==='admin'){app.innerHTML=renderAdmin()}else if(appState.user.role==='customer'){app.innerHTML=renderCustomer()}}

function renderLogin(){return `<div class="container"><div class="card"><div class="text-center mt-20"><h1 style="color:#4f46e5;font-size:32px">SafePay BNPL</h1><p>Salary-Backed Financial Solutions</p></div><div style="margin-top:30px"><p style="margin-bottom:20px;font-weight:bold">Select Your Role:</p><div class="grid" style="grid-template-columns:repeat(2,1fr)"><button class="btn" onclick="setRole('merchant')" style="background:${appState.selectedRole==='merchant'?'#4f46e5':'#9ca3af'}">Merchant</button><button class="btn" onclick="setRole('employer')" style="background:${appState.selectedRole==='employer'?'#4f46e5':'#9ca3af'}">Employer</button><button class="btn" onclick="setRole('admin')" style="background:${appState.selectedRole==='admin'?'#4f46e5':'#9ca3af'}">Admin</button><button class="btn" onclick="setRole('customer')" style="background:${appState.selectedRole==='customer'?'#4f46e5':'#9ca3af'}">Customer</button></div></div><div style="margin-top:20px"><div class="form-group"><label>Username</label><input type="text" id="username" placeholder="Enter username"/></div><button class="btn" style="width:100%;padding:12px" onclick="handleLogin()">Sign In</button></div><p style="text-align:center;margin-top:20px;color:#666;font-size:12px">Demo: Use any username with selected role</p></div></div>`}

function renderMerchant(){return `<div class="container"><div class="header"><h1>Merchant Portal - ${appState.user.username}</h1><button class="btn btn-secondary" onclick="logout()">Logout</button></div><div class="tab-nav"><button class="tab-nav-btn ${appState.currentView==='initiate'?'active':''}" onclick="setView('initiate')">New Transaction</button><button class="tab-nav-btn ${appState.currentView==='history'?'active':''}" onclick="setView('history')">History</button></div>${appState.currentView==='initiate'?`<div class="card"><h2>SafePay BNPL Checkout</h2>${!appState.loading&&!appState.transactionStatus?`<form onsubmit="handleTransaction(event)"><div class="form-group"><label>Customer Policy Number *</label><input type="text" id="policyNumber" placeholder="202600123456" maxlength="12" required/></div><div class="form-group"><label>Amount (UGX) *</label><input type="number" id="amount" placeholder="120000" min="1000" max="1000000" required/></div><div class="form-group"><label>Description</label><input type="text" id="description" placeholder="Item description"/></div><button type="submit" class="btn" style="width:100%;padding:12px">Send Request</button></form>`:`${appState.loading?`<div class="text-center"><p style="font-size:18px;color:#666">Verifying customer and checking affordability limits...</p></div>`:`<div class="text-center"><div style="font-size:40px;margin:20px 0">${appState.transaction.isApproved?'✓':'✕'}</div><h2>${appState.transaction.isApproved?'APPROVED':'DECLINED'}</h2><div class="card" style="margin:20px auto;max-width:400px"><p><strong>Amount:</strong> UGX ${parseInt(appState.transaction.amount).toLocaleString()}</p><p><strong>Limit:</strong> UGX ${parseInt(appState.transaction.affordability).toLocaleString()}</p><p><strong>Status:</strong> ${appState.transaction.isApproved?'✓ Within Limit':'✗ Exceeds Limit'}</p></div><button class="btn" onclick="resetTransaction()">New Transaction</button></div>`}`}</div>`:`<div class="card"><h3>Transaction History</h3><table><tr><th>Date</th><th>Merchant</th><th>Amount</th><th>Status</th></tr><tr><td>20 Jan 2026</td><td>Jumia</td><td>UGX 123,600</td><td><span class="badge badge-success">DELIVERED</span></td></tr><tr><td>19 Jan 2026</td><td>Glovo</td><td>UGX 85,000</td><td><span class="badge badge-warning">PENDING</span></td></tr></table></div>`}</div>`}

function renderEmployer(){return `<div class="container"><div class="header"><h1>Employer Portal</h1><button class="btn btn-secondary" onclick="logout()">Logout</button></div><div class="grid"><div class="card"><div class="text-lg">Active Employees</div><div style="font-size:24px;color:#4f46e5;font-weight:bold;margin-top:10px">1,247</div></div><div class="card"><div class="text-lg">Pending Deductions</div><div style="font-size:24px;color:#dc2626;font-weight:bold;margin-top:10px">89</div></div><div class="card"><div class="text-lg">This Month</div><div style="font-size:24px;color:#4f46e5;font-weight:bold;margin-top:10px">UGX 18.4M</div></div></div></div>`}

function renderAdmin(){return `<div class="container"><div class="header"><h1>Admin Dashboard</h1><button class="btn btn-secondary" onclick="logout()">Logout</button></div><div class="tab-nav"><button class="tab-nav-btn ${appState.adminView==='dashboard'?'active':''}" onclick="setAdminView('dashboard')">Dashboard</button><button class="tab-nav-btn ${appState.adminView==='employers'?'active':''}" onclick="setAdminView('employers')">Employers</button><button class="tab-nav-btn ${appState.adminView==='transactions'?'active':''}" onclick="setAdminView('transactions')">Transactions</button></div>${appState.adminView==='dashboard'?`<div class="grid"><div class="card"><div class="text-lg">Total Employers</div><div style="font-size:28px;color:#4f46e5;font-weight:bold;margin-top:10px">${appState.employers.length}</div></div><div class="card"><div class="text-lg">Total Employees</div><div style="font-size:28px;color:#4f46e5;font-weight:bold;margin-top:10px">${Object.values(appState.employees).flat().length}</div></div><div class="card"><div class="text-lg">Transactions</div><div style="font-size:28px;color:#4f46e5;font-weight:bold;margin-top:10px">${appState.transactions.length}</div></div><div class="card"><div class="text-lg">Approval Rate</div><div style="font-size:28px;color:#16a34a;font-weight:bold;margin-top:10px">87%</div></div></div>`:`${appState.adminView==='employers'?`<div><button class="btn" onclick="showAddEmployerModal()">+ Add Employer</button>${appState.showAddEmployerModal?`<div class="card" style="margin-top:20px"><h3>Add New Employer</h3><form onsubmit="addEmployer();return false"><div class="form-group"><input type="text" id="employerName" placeholder="Company Name" value="${appState.newEmployer.name}" required/></div><div class="form-group"><input type="number" id="employerCount" placeholder="Number of Employees" value="${appState.newEmployer.employees}"/></div><div class="form-group"><input type="number" id="employerLimit" placeholder="Max Limit" value="${appState.newEmployer.limit}"/></div><div class="form-group"><select id="deductionPercent"><option value="">Monthly Deduction %</option><option value="0.25">25% of Salary</option><option value="0.30">30% of Salary</option><option value="0.35">35% of Salary</option></select></div><button type="submit" class="btn">Save</button><button type="button" class="btn btn-secondary" onclick="cancelAddEmployer()">Cancel</button></form></div>`:''}${appState.employers.map(emp=>`<div class="card" style="margin-top:20px"><p><strong>${emp.name}</strong></p><p>Employees: ${emp.employees} | Limit: UGX ${emp.limit.toLocaleString()} | Deduction: ${(emp.monthlyDeduction*100).toFixed(0)}%</p><button class="btn btn-secondary" onclick="selectEmployer('${emp.id}')" style="margin-top:10px">${appState.selectedEmployerId===emp.id?'Hide':'Show'} Employees</button>${appState.selectedEmployerId===emp.id?`<div style="margin-top:15px"><h4>Employee List:</h4><table><tr><th>Name</th><th>Salary</th><th>Limit</th><th>Status</th></tr>${(appState.employees[emp.id]||[]).map(e=>`<tr><td>${e.name}</td><td>UGX ${e.salary.toLocaleString()}</td><td>UGX ${e.limit.toLocaleString()}</td><td>${e.status}</td></tr>`).join('')}</table></div>`:''}</div>`).join('')}</div>`:`<div><h3>Pending Transactions</h3>${appState.transactions.map(tx=>{const isApproved=tx.amount<=tx.affordability;return `<div class="card" style="margin-bottom:15px"><p><strong>${tx.id}</strong> - ${tx.customer} | ${tx.merchant} | ${tx.date}</p><p>Amount: UGX ${tx.amount.toLocaleString()} | Limit: UGX ${tx.affordability.toLocaleString()}</p><span class="badge ${isApproved?'badge-success':'badge-danger'}">${isApproved?'APPROVED':'REJECTED'}</span></div>`}).join('')}</div>`}`}</div>`}

function renderCustomer(){return `<div class="container"><div class="header"><h1>My Account</h1><button class="btn btn-secondary" onclick="logout()">Logout</button></div><div class="grid"><div class="card"><p>Your BNPL Limit</p><p style="font-size:24px;color:#4f46e5;font-weight:bold;margin-top:10px">UGX 450,000</p></div><div class="card"><p>Next Payment</p><p style="font-size:24px;font-weight:bold;margin-top:10px">UGX 97,500</p><p style="color:#f59e0b;margin-top:5px">Due in 8 days</p></div><div class="card"><p>Pending Authorizations</p><p style="font-size:24px;color:#dc2626;font-weight:bold;margin-top:10px">${appState.transactions.filter(t=>t.status==='pending').length}</p></div></div><div class="grid"><div class="card"><h3>Pending Authorizations</h3>${appState.transactions.filter(t=>t.status==='pending').map(tx=>`<div style="background:#fffbeb;border:1px solid #fcd34d;padding:10px;margin-bottom:10px;border-radius:4px"><p><strong>${tx.merchant}</strong></p><p>Amount: UGX ${tx.amount.toLocaleString()}</p><button class="btn" style="margin-top:10px;margin-right:5px" onclick="authorizeTransaction('${tx.id}')">Approve</button><button class="btn btn-secondary" style="margin-top:10px" onclick="declineTransaction('${tx.id}')">Decline</button></div>`).join('')}</div><div class="card"><h3>Repayment Schedule</h3><p style="background:#f0f0f0;padding:10px;margin:5px 0">Today - Installment 1: UGX 97,500</p><p style="background:#f0f0f0;padding:10px;margin:5px 0">Dec 15 - Installment 2: UGX 97,500</p><p style="background:#f0f0f0;padding:10px;margin:5px 0">Dec 22 - Installment 3: UGX 97,500</p></div></div><div class="card"><h3>Transaction History</h3><table><tr><th>Date</th><th>Merchant</th><th>Amount</th><th>Status</th></tr>${appState.transactions.map(tx=>`<tr><td>${tx.date}</td><td>${tx.merchant}</td><td>UGX ${tx.amount.toLocaleString()}</td><td><span class="badge ${tx.status==='approved'?'badge-success':tx.status==='pending'?'badge-warning':'badge-danger'}">${tx.status.toUpperCase()}</span></td></tr>`).join('')}</table></div></div>`}

function setRole(role){appState.selectedRole=role;render()}
function setView(view){appState.currentView=view;render()}
function setAdminView(view){appState.adminView=view;render()}
function showAddEmployerModal(){appState.showAddEmployerModal=true;render()}
function cancelAddEmployer(){appState.showAddEmployerModal=false;render()}
function selectEmployer(id){appState.selectedEmployerId=appState.selectedEmployerId===id?null:id;render()}
function authorizeTransaction(id){const tx=appState.transactions.find(t=>t.id===id);if(tx)tx.status='approved';render()}
function declineTransaction(id){const tx=appState.transactions.find(t=>t.id===id);if(tx)tx.status='declined';render()}

function handleLogin(){const role=appState.selectedRole;const username=document.getElementById('username').value||'Demo User';if(role&&username){appState.user={role,username};render()}}

function handleTransaction(e){e.preventDefault();const policyNumber=document.getElementById('policyNumber').value;const amount=parseInt(document.getElementById('amount').value);let affordability=450000;for(const empList of Object.values(appState.employees)){const emp=empList.find(e=>e.policyNumber===policyNumber);if(emp){affordability=emp.limit;break}}appState.transaction={policyNumber,amount,affordability,isApproved:amount<=affordability};appState.loading=true;render();setTimeout(()=>{appState.loading=false;appState.transactionStatus=appState.transaction.isApproved?'approved':'declined';const newTx={id:'SP-'+Date.now(),policyNumber,amount,merchant:'SafePay',date:new Date().toLocaleDateString(),status:appState.transaction.isApproved?'approved':'declined',affordability,customer:'Demo'};appState.transactions.unshift(newTx);render()},3000)}

function resetTransaction(){appState.transaction={policyNumber:'',amount:'',description:''};appState.transactionStatus=null;appState.currentView='initiate';render()}

function addEmployer(){const name=document.getElementById('employerName').value;const employees=parseInt(document.getElementById('employerCount').value)||0;const limit=parseInt(document.getElementById('employerLimit').value)||0;const deduction=parseFloat(document.getElementById('deductionPercent').value)||0.3;if(name&&employees&&limit){const id=(Math.max(...appState.employers.map(e=>parseInt(e.id)))+1).toString();appState.employers.push({id,name,employees,limit,monthlyDeduction:deduction});appState.employees[id]=[];appState.showAddEmployerModal=false;render()}}

function logout(){appState.user=null;appState.selectedRole=null;appState.currentView='initiate';appState.adminView='dashboard';render()}

render();
</script>
</body>
</html>
